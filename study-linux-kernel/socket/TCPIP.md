# 目的
学习SOCKET: TCP/IP网络基础

# 目录
- [目的](#目的)
- [目录](#目录)
- [互联网及其协议与层](#互联网及其协议与层)
  - [协议](#协议)
  - [封装](#封装)
- [数据链路层](#数据链路层)
- [网络层: IP](#网络层-ip)
  - [IP传输数据报](#ip传输数据报)
  - [IP 是无连接和不可靠的](#ip-是无连接和不可靠的)
  - [IP可能会对数据进行分段](#ip可能会对数据进行分段)
- [IP地址](#ip地址)

# 互联网及其协议与层
互联网络(internetwork)或互联网(internet, **小写i**)会将不同计算机用网络连接起来实现相互通信。互联网是由计算机网络组成的网络。 术语子网络或子网， 用了指组成因特网的其中一个网络。

TCP/IP为使用最为广泛的互联网互联协议，术语Internet(**大写I**)被用来指将全球成千上万的计算机连接起来的TCP/IP互联网。

## 协议
一个联网协议是定义如何在一个网络上传输信息的一组规则。 联网协议通常会被组织成一系列的层， 其中每一层都构建于下层之上并提供特性以供上层使用。

TCP/IP协议套件是一个分层联网协议， 它包括因特网协议(IP)和位于其上层的各个协议层。实现这些层的代码通常被称为**协议栈**。
**TCP/IP**是从传输控制协议(TCP)是使用最广泛的传输协议的事实而得出。

> 协议分层如此强大和灵活的一个重要原因是每个协议层都对上层隐藏下层的操作和复杂些。

## 封装

封装是分层联网协议中的一个重要原则。 封装的关键概念是低层不会将高层向低层传递的信息进行任何处理， 而只是附加本层数据，然后传递到下一层。

![TCP/IP基础架构](img/tcp-ip_architecture.jpg)

![TCP/IP 分层封装](img/tcp-ip_encapsulation.jpg)

# 数据链路层

数据链路层由设备驱动和底层物理媒介(电话线、或光纤)的硬件接口(网卡)构成。

数据链路层需要将网络层传递的数据报封装成为帧进行传输。每个帧包含一个头，头中包含目标地址和帧的大小。这一层可能会进行错误检测、重传以及流量控制。

> 应用程序无需关心数据链路层， 因为链路层所有通信细节由驱动和硬件来处理。

数据链路层中比较重要的一个特点是**最大传输单元(MTU)**。其大小为传输的**帧大小的上限**。 不同的数据链路层的MTU是不同的(路径MTU)。

以下命令可查看系统中网络接口的MTU大小：
```shell
netstat -i
```

# 网络层: IP
网络层关注将数据包从源主机发送到目标主机。 主要包括如下步骤：
- 将数据分解成足够小的片段便于在数据链路层进行传输
- 在因特网上路由数据
- 为传输层提供服务

在TCP/IP中， 网络层主要协议为IP。 包括:
- IPv4: 32位地址
- IPv6: 128位地址

一个裸体socket(**SOCK_RAW**)允许应用直接与IP层进行通信(而不经过传输层)。

## IP传输数据报
IP以数据报的形式来传输数据。 一个IP数据报包含一个头， 其大小范围为20~60字节。 头中包含目标主机地址及源主机地址。

> 发送主机可以伪造一个包的源地址，  这也是SYN泛洪实现的基础

IP的实现中其数据报大小存在一个上限。 其大小至少与规定的IP最小重组缓冲区大小一样大。 **IPv4中限制值为576字节， IPv6中为1500字节。**

## IP 是无连接和不可靠的
IP是一种无连接协议， 未为两个主机之间提供一个虚拟电路。 同时， IP也是一种不可靠协议: 它尽力而为地将数据报从发送者送往接收者。 **不保证达到顺序， 不保证不重复， 不保证一定会到达。** IP没提供错误恢复，头信息错误包直接被丢弃。

> IPv4为IP头部提供了校验和， 用以检测头中错误。 **但并未对包中的数据提供错误检测**。 IPv6并未为IP头提供校验和， 需依靠高层协议来完成。
> 
> UDP校验和在IPv4中是可选的， 一般都是启用的， 而在IPv6中是强制的。 TCP校验和在IPv4和IPv6中都是强制的。

## IP可能会对数据进行分段
IPv4数据报最大大小为65535字节。 默认情况下IPv6的数据报大小为65575(40字节存储头信息， 65535字节用于存储数据)。

前面提到过链路层存在一个数据帧大小上限(MTU)。 在常见的以太网中其大小为1500字节(远小于IP数据报最大大小)。 
IP还定义了**路径MTU**概念：即从源主机到目的主机之间路由上所有数据链路层的最小MTU。

当IP数据报大小大于MTU时， IP会将数据报分段成适合在网络上传输的单元。最终到达目的主机后再重组数据报。

# IP地址

