#  进程

### 概述

进程是一个可执行程序的实例。

进程与程序的区别:  程序是包含了一系列信息的文件， 这些信息描述了如何在运行时创建一个进程， 所包含的内容如下:

- 二进制格式标识: 可执行文件格式的元信息(metainformation)。内核利用此信息来解释文件中其他信息。
- 机器语言指令: 对程序算法进行编码
- 程序入口地址: 标识程序开始执行时的起始指令位置。
- 数据: 程序文件包含的变量初始值和程序所使用的字面常量(比如字符串)
- 符号表及重定位表: 描述程序中函数与变量的位置与名称。用于调试和运行时的符号解析
- 共享库和动态连接信息: 列出程序运行所需要使用的共享库以及加载共享库的动态链接器的路径名

可以用一个程序来创建许多进程， 或反过来说， 许多进程运行的可以是同意程序。

进程是由内核定义的抽象实体， 并为该实体分配用以执行程序的系统资源。从内核角度看， 进程由内存空间和一系列内核数据结构组成， 其中用户内存空间包含了程序代码及代码所使用的变量， 而内核数据用于维护进程状态信息。

### 进程内存布局

每个进程所分配的内存由许多部分组成， 通常称之为"段"。 如下所示:

- 文本段：包含进程运行程序的机器语言指令。 文本段具有**只读**属性，防止进程通过错误指针修改。 **因为多个进程可同时运行同一程序**。一份程序代码拷贝可以映射到所有这些进程的虚拟地址空间中。
- 初始化数据段：包含显示初始化的全局变量和静态变量。当程序加载到内存时， 从可执行文件中读取这些值。
- 未初始化数据段：包含未显示初始化的全局变量和静态变量。程序启动后， 系统为本段内所有内存初始化为0. 通常称为**BSS段**。 之所以与初始化数据段区分， 由于程序在磁盘上存储时，**没有必要为未经初始化的变量分配存储空间**。只需记录其位置与所需大小。
- 栈：一个动态增长和收缩的段， 由栈帧组成。 系统会为每个当前调用的函数分配一个栈帧。 其中存储了函数的局部变量、实参与返回值。
- 堆：是在可运行时动态进行内存分配的一块区域。堆顶称作**program break**。

可使用`size`命令查看二进制可执行文件的文本段、初始化数据段、非初始化数据段的大小。





### 虚拟内存管理

### 进程的创建、退出、等待

![进程创建过程](img/进程创建.png)

- 创建新进程

```c
#include <unistd.h>

/*
此方法返回两次，
在父进程中返回创建子进程的id，如果失败则返回-1。
对于子进程总是返回0
*/
pid_t fork(void);
```



